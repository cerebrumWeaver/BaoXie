import requests
import pandas as pd
import time
import os

start = time.time()
datetime_ = time.strftime('%Y-%m-%d', time.localtime(time.time()))
# datetime_ = time.strftime('%Y-%m-%d', time.strptime('2023-06-08', '%Y-%m-%d'))
# url_ = 'http://zphx-gpic-zj.baoxietech.com/invoice/datatable?draw=5&columns%5B0%5D.data=id&columns%5B0%5D.name=&columns%5B0%5D.searchable=false&columns%5B0%5D.orderable=false&columns%5B0%5D.search.value=&columns%5B0%5D.search.regex=false&columns%5B1%5D.data=id&columns%5B1%5D.name=&columns%5B1%5D.searchable=false&columns%5B1%5D.orderable=false&columns%5B1%5D.search.value=&columns%5B1%5D.search.regex=false&columns%5B2%5D.data=errorMsg&columns%5B2%5D.name=&columns%5B2%5D.searchable=true&columns%5B2%5D.orderable=true&columns%5B2%5D.search.value=&columns%5B2%5D.search.regex=false&columns%5B3%5D.data=scanDate&columns%5B3%5D.name=&columns%5B3%5D.searchable=true&columns%5B3%5D.orderable=true&columns%5B3%5D.search.value=&columns%5B3%5D.search.regex=false&columns%5B4%5D.data=batch&columns%5B4%5D.name=&columns%5B4%5D.searchable=true&columns%5B4%5D.orderable=true&columns%5B4%5D.search.value=&columns%5B4%5D.search.regex=false&columns%5B5%5D.data=sequence&columns%5B5%5D.name=&columns%5B5%5D.searchable=true&columns%5B5%5D.orderable=true&columns%5B5%5D.search.value=&columns%5B5%5D.search.regex=false&columns%5B6%5D.data=imageName&columns%5B6%5D.name=&columns%5B6%5D.searchable=true&columns%5B6%5D.orderable=true&columns%5B6%5D.search.value=&columns%5B6%5D.search.regex=false&columns%5B7%5D.data=invoicedDate&columns%5B7%5D.name=&columns%5B7%5D.searchable=true&columns%5B7%5D.orderable=true&columns%5B7%5D.search.value=&columns%5B7%5D.search.regex=false&columns%5B8%5D.data=code&columns%5B8%5D.name=&columns%5B8%5D.searchable=true&columns%5B8%5D.orderable=true&columns%5B8%5D.search.value=&columns%5B8%5D.search.regex=false&columns%5B9%5D.data=no&columns%5B9%5D.name=&columns%5B9%5D.searchable=true&columns%5B9%5D.orderable=true&columns%5B9%5D.search.value=&columns%5B9%5D.search.regex=false&columns%5B10%5D.data=branchId&columns%5B10%5D.name=&columns%5B10%5D.searchable=true&columns%5B10%5D.orderable=true&columns%5B10%5D.search.value=&columns%5B10%5D.search.regex=false&columns%5B11%5D.data=id&columns%5B11%5D.name=&columns%5B11%5D.searchable=true&columns%5B11%5D.orderable=false&columns%5B11%5D.search.value=&columns%5B11%5D.search.regex=false&columns%5B12%5D.data=supplierId&columns%5B12%5D.name=&columns%5B12%5D.searchable=true&columns%5B12%5D.orderable=false&columns%5B12%5D.search.value=&columns%5B12%5D.search.regex=false&columns%5B13%5D.data=supplierId&columns%5B13%5D.name=&columns%5B13%5D.searchable=true&columns%5B13%5D.orderable=false&columns%5B13%5D.search.value=&columns%5B13%5D.search.regex=false&columns%5B14%5D.data=amount&columns%5B14%5D.name=&columns%5B14%5D.searchable=true&columns%5B14%5D.orderable=true&columns%5B14%5D.search.value=&columns%5B14%5D.search.regex=false&columns%5B15%5D.data=amountVat&columns%5B15%5D.name=&columns%5B15%5D.searchable=true&columns%5B15%5D.orderable=true&columns%5B15%5D.search.value=&columns%5B15%5D.search.regex=false&columns%5B16%5D.data=amountTotal&columns%5B16%5D.name=&columns%5B16%5D.searchable=true&columns%5B16%5D.orderable=true&columns%5B16%5D.search.value=&columns%5B16%5D.search.regex=false&columns%5B17%5D.data=rateVat&columns%5B17%5D.name=&columns%5B17%5D.searchable=true&columns%5B17%5D.orderable=true&columns%5B17%5D.search.value=&columns%5B17%5D.search.regex=false&columns%5B18%5D.data=subject&columns%5B18%5D.name=&columns%5B18%5D.searchable=true&columns%5B18%5D.orderable=true&columns%5B18%5D.search.value=&columns%5B18%5D.search.regex=false&columns%5B19%5D.data=verificationUserId&columns%5B19%5D.name=&columns%5B19%5D.searchable=true&columns%5B19%5D.orderable=false&columns%5B19%5D.search.value=&columns%5B19%5D.search.regex=false&columns%5B20%5D.data=verificationBranchId&columns%5B20%5D.name=&columns%5B20%5D.searchable=true&columns%5B20%5D.orderable=false&columns%5B20%5D.search.value=&columns%5B20%5D.search.regex=false&order%5B0%5D.column=4&order%5B0%5D.dir=desc&order%5B1%5D.column=5&order%5B1%5D.dir=asc&start=0&length=10&search.value=&search.regex=false&batch=&imageName=&code=&no=&branchId=&supplierId=&verificationBranchId=&times=2023-05-26+00%3A00+-+2023-05-26+17%3A13&status=&valid=&enabled=&_=1685000326609'
url_ = f'http://zphx-gpic-zj.baoxietech.com/invoice/datatable?draw=5&columns%5B0%5D.data=id&columns%5B0%5D.name=&columns%5B0%5D.searchable=false&columns%5B0%5D.orderable=false&columns%5B0%5D.search.value=&columns%5B0%5D.search.regex=false&columns%5B1%5D.data=id&columns%5B1%5D.name=&columns%5B1%5D.searchable=false&columns%5B1%5D.orderable=false&columns%5B1%5D.search.value=&columns%5B1%5D.search.regex=false&columns%5B2%5D.data=errorMsg&columns%5B2%5D.name=&columns%5B2%5D.searchable=true&columns%5B2%5D.orderable=true&columns%5B2%5D.search.value=&columns%5B2%5D.search.regex=false&columns%5B3%5D.data=scanDate&columns%5B3%5D.name=&columns%5B3%5D.searchable=true&columns%5B3%5D.orderable=true&columns%5B3%5D.search.value=&columns%5B3%5D.search.regex=false&columns%5B4%5D.data=batch&columns%5B4%5D.name=&columns%5B4%5D.searchable=true&columns%5B4%5D.orderable=true&columns%5B4%5D.search.value=&columns%5B4%5D.search.regex=false&columns%5B5%5D.data=sequence&columns%5B5%5D.name=&columns%5B5%5D.searchable=true&columns%5B5%5D.orderable=true&columns%5B5%5D.search.value=&columns%5B5%5D.search.regex=false&columns%5B6%5D.data=imageName&columns%5B6%5D.name=&columns%5B6%5D.searchable=true&columns%5B6%5D.orderable=true&columns%5B6%5D.search.value=&columns%5B6%5D.search.regex=false&columns%5B7%5D.data=invoicedDate&columns%5B7%5D.name=&columns%5B7%5D.searchable=true&columns%5B7%5D.orderable=true&columns%5B7%5D.search.value=&columns%5B7%5D.search.regex=false&columns%5B8%5D.data=code&columns%5B8%5D.name=&columns%5B8%5D.searchable=true&columns%5B8%5D.orderable=true&columns%5B8%5D.search.value=&columns%5B8%5D.search.regex=false&columns%5B9%5D.data=no&columns%5B9%5D.name=&columns%5B9%5D.searchable=true&columns%5B9%5D.orderable=true&columns%5B9%5D.search.value=&columns%5B9%5D.search.regex=false&columns%5B10%5D.data=branchId&columns%5B10%5D.name=&columns%5B10%5D.searchable=true&columns%5B10%5D.orderable=true&columns%5B10%5D.search.value=&columns%5B10%5D.search.regex=false&columns%5B11%5D.data=id&columns%5B11%5D.name=&columns%5B11%5D.searchable=true&columns%5B11%5D.orderable=false&columns%5B11%5D.search.value=&columns%5B11%5D.search.regex=false&columns%5B12%5D.data=supplierId&columns%5B12%5D.name=&columns%5B12%5D.searchable=true&columns%5B12%5D.orderable=false&columns%5B12%5D.search.value=&columns%5B12%5D.search.regex=false&columns%5B13%5D.data=supplierId&columns%5B13%5D.name=&columns%5B13%5D.searchable=true&columns%5B13%5D.orderable=false&columns%5B13%5D.search.value=&columns%5B13%5D.search.regex=false&columns%5B14%5D.data=amount&columns%5B14%5D.name=&columns%5B14%5D.searchable=true&columns%5B14%5D.orderable=true&columns%5B14%5D.search.value=&columns%5B14%5D.search.regex=false&columns%5B15%5D.data=amountVat&columns%5B15%5D.name=&columns%5B15%5D.searchable=true&columns%5B15%5D.orderable=true&columns%5B15%5D.search.value=&columns%5B15%5D.search.regex=false&columns%5B16%5D.data=amountTotal&columns%5B16%5D.name=&columns%5B16%5D.searchable=true&columns%5B16%5D.orderable=true&columns%5B16%5D.search.value=&columns%5B16%5D.search.regex=false&columns%5B17%5D.data=rateVat&columns%5B17%5D.name=&columns%5B17%5D.searchable=true&columns%5B17%5D.orderable=true&columns%5B17%5D.search.value=&columns%5B17%5D.search.regex=false&columns%5B18%5D.data=subject&columns%5B18%5D.name=&columns%5B18%5D.searchable=true&columns%5B18%5D.orderable=true&columns%5B18%5D.search.value=&columns%5B18%5D.search.regex=false&columns%5B19%5D.data=verificationUserId&columns%5B19%5D.name=&columns%5B19%5D.searchable=true&columns%5B19%5D.orderable=false&columns%5B19%5D.search.value=&columns%5B19%5D.search.regex=false&columns%5B20%5D.data=verificationBranchId&columns%5B20%5D.name=&columns%5B20%5D.searchable=true&columns%5B20%5D.orderable=false&columns%5B20%5D.search.value=&columns%5B20%5D.search.regex=false&order%5B0%5D.column=4&order%5B0%5D.dir=desc&order%5B1%5D.column=5&order%5B1%5D.dir=asc&start=0&length=10&search.value=&search.regex=false&batch=&imageName=&code=&no=&branchId=&supplierId=&verificationBranchId=&times={datetime_}+00%3A00+-+{datetime_}+23%3A59&status=&valid=&enabled=&_=1685000326609'
headers_ = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.97 Safari/537.36',
    'Cookie': 'ZPHX_SESSION=414350D3500482728316BB4055E2BD79'
}
recordsTotal = requests.get(url=url_, headers=headers_).json()['recordsTotal']
data = []
for i in range(0, recordsTotal, 10):
    print(i)
    # url_ = f'http://zphx-gpic-zj.baoxietech.com/invoice/datatable?draw=5&columns%5B0%5D.data=id&columns%5B0%5D.name=&columns%5B0%5D.searchable=false&columns%5B0%5D.orderable=false&columns%5B0%5D.search.value=&columns%5B0%5D.search.regex=false&columns%5B1%5D.data=id&columns%5B1%5D.name=&columns%5B1%5D.searchable=false&columns%5B1%5D.orderable=false&columns%5B1%5D.search.value=&columns%5B1%5D.search.regex=false&columns%5B2%5D.data=errorMsg&columns%5B2%5D.name=&columns%5B2%5D.searchable=true&columns%5B2%5D.orderable=true&columns%5B2%5D.search.value=&columns%5B2%5D.search.regex=false&columns%5B3%5D.data=scanDate&columns%5B3%5D.name=&columns%5B3%5D.searchable=true&columns%5B3%5D.orderable=true&columns%5B3%5D.search.value=&columns%5B3%5D.search.regex=false&columns%5B4%5D.data=batch&columns%5B4%5D.name=&columns%5B4%5D.searchable=true&columns%5B4%5D.orderable=true&columns%5B4%5D.search.value=&columns%5B4%5D.search.regex=false&columns%5B5%5D.data=sequence&columns%5B5%5D.name=&columns%5B5%5D.searchable=true&columns%5B5%5D.orderable=true&columns%5B5%5D.search.value=&columns%5B5%5D.search.regex=false&columns%5B6%5D.data=imageName&columns%5B6%5D.name=&columns%5B6%5D.searchable=true&columns%5B6%5D.orderable=true&columns%5B6%5D.search.value=&columns%5B6%5D.search.regex=false&columns%5B7%5D.data=invoicedDate&columns%5B7%5D.name=&columns%5B7%5D.searchable=true&columns%5B7%5D.orderable=true&columns%5B7%5D.search.value=&columns%5B7%5D.search.regex=false&columns%5B8%5D.data=code&columns%5B8%5D.name=&columns%5B8%5D.searchable=true&columns%5B8%5D.orderable=true&columns%5B8%5D.search.value=&columns%5B8%5D.search.regex=false&columns%5B9%5D.data=no&columns%5B9%5D.name=&columns%5B9%5D.searchable=true&columns%5B9%5D.orderable=true&columns%5B9%5D.search.value=&columns%5B9%5D.search.regex=false&columns%5B10%5D.data=branchId&columns%5B10%5D.name=&columns%5B10%5D.searchable=true&columns%5B10%5D.orderable=true&columns%5B10%5D.search.value=&columns%5B10%5D.search.regex=false&columns%5B11%5D.data=id&columns%5B11%5D.name=&columns%5B11%5D.searchable=true&columns%5B11%5D.orderable=false&columns%5B11%5D.search.value=&columns%5B11%5D.search.regex=false&columns%5B12%5D.data=supplierId&columns%5B12%5D.name=&columns%5B12%5D.searchable=true&columns%5B12%5D.orderable=false&columns%5B12%5D.search.value=&columns%5B12%5D.search.regex=false&columns%5B13%5D.data=supplierId&columns%5B13%5D.name=&columns%5B13%5D.searchable=true&columns%5B13%5D.orderable=false&columns%5B13%5D.search.value=&columns%5B13%5D.search.regex=false&columns%5B14%5D.data=amount&columns%5B14%5D.name=&columns%5B14%5D.searchable=true&columns%5B14%5D.orderable=true&columns%5B14%5D.search.value=&columns%5B14%5D.search.regex=false&columns%5B15%5D.data=amountVat&columns%5B15%5D.name=&columns%5B15%5D.searchable=true&columns%5B15%5D.orderable=true&columns%5B15%5D.search.value=&columns%5B15%5D.search.regex=false&columns%5B16%5D.data=amountTotal&columns%5B16%5D.name=&columns%5B16%5D.searchable=true&columns%5B16%5D.orderable=true&columns%5B16%5D.search.value=&columns%5B16%5D.search.regex=false&columns%5B17%5D.data=rateVat&columns%5B17%5D.name=&columns%5B17%5D.searchable=true&columns%5B17%5D.orderable=true&columns%5B17%5D.search.value=&columns%5B17%5D.search.regex=false&columns%5B18%5D.data=subject&columns%5B18%5D.name=&columns%5B18%5D.searchable=true&columns%5B18%5D.orderable=true&columns%5B18%5D.search.value=&columns%5B18%5D.search.regex=false&columns%5B19%5D.data=verificationUserId&columns%5B19%5D.name=&columns%5B19%5D.searchable=true&columns%5B19%5D.orderable=false&columns%5B19%5D.search.value=&columns%5B19%5D.search.regex=false&columns%5B20%5D.data=verificationBranchId&columns%5B20%5D.name=&columns%5B20%5D.searchable=true&columns%5B20%5D.orderable=false&columns%5B20%5D.search.value=&columns%5B20%5D.search.regex=false&order%5B0%5D.column=4&order%5B0%5D.dir=desc&order%5B1%5D.column=5&order%5B1%5D.dir=asc&start={i}&length=10&search.value=&search.regex=false&batch=&imageName=&code=&no=&branchId=&supplierId=&verificationBranchId=&times=2023-05-26+00%3A00+-+2023-05-26+17%3A13&status=&valid=&enabled=&_=1685000326609'
    url_ = f'http://zphx-gpic-zj.baoxietech.com/invoice/datatable?draw=5&columns%5B0%5D.data=id&columns%5B0%5D.name=&columns%5B0%5D.searchable=false&columns%5B0%5D.orderable=false&columns%5B0%5D.search.value=&columns%5B0%5D.search.regex=false&columns%5B1%5D.data=id&columns%5B1%5D.name=&columns%5B1%5D.searchable=false&columns%5B1%5D.orderable=false&columns%5B1%5D.search.value=&columns%5B1%5D.search.regex=false&columns%5B2%5D.data=errorMsg&columns%5B2%5D.name=&columns%5B2%5D.searchable=true&columns%5B2%5D.orderable=true&columns%5B2%5D.search.value=&columns%5B2%5D.search.regex=false&columns%5B3%5D.data=scanDate&columns%5B3%5D.name=&columns%5B3%5D.searchable=true&columns%5B3%5D.orderable=true&columns%5B3%5D.search.value=&columns%5B3%5D.search.regex=false&columns%5B4%5D.data=batch&columns%5B4%5D.name=&columns%5B4%5D.searchable=true&columns%5B4%5D.orderable=true&columns%5B4%5D.search.value=&columns%5B4%5D.search.regex=false&columns%5B5%5D.data=sequence&columns%5B5%5D.name=&columns%5B5%5D.searchable=true&columns%5B5%5D.orderable=true&columns%5B5%5D.search.value=&columns%5B5%5D.search.regex=false&columns%5B6%5D.data=imageName&columns%5B6%5D.name=&columns%5B6%5D.searchable=true&columns%5B6%5D.orderable=true&columns%5B6%5D.search.value=&columns%5B6%5D.search.regex=false&columns%5B7%5D.data=invoicedDate&columns%5B7%5D.name=&columns%5B7%5D.searchable=true&columns%5B7%5D.orderable=true&columns%5B7%5D.search.value=&columns%5B7%5D.search.regex=false&columns%5B8%5D.data=code&columns%5B8%5D.name=&columns%5B8%5D.searchable=true&columns%5B8%5D.orderable=true&columns%5B8%5D.search.value=&columns%5B8%5D.search.regex=false&columns%5B9%5D.data=no&columns%5B9%5D.name=&columns%5B9%5D.searchable=true&columns%5B9%5D.orderable=true&columns%5B9%5D.search.value=&columns%5B9%5D.search.regex=false&columns%5B10%5D.data=branchId&columns%5B10%5D.name=&columns%5B10%5D.searchable=true&columns%5B10%5D.orderable=true&columns%5B10%5D.search.value=&columns%5B10%5D.search.regex=false&columns%5B11%5D.data=id&columns%5B11%5D.name=&columns%5B11%5D.searchable=true&columns%5B11%5D.orderable=false&columns%5B11%5D.search.value=&columns%5B11%5D.search.regex=false&columns%5B12%5D.data=supplierId&columns%5B12%5D.name=&columns%5B12%5D.searchable=true&columns%5B12%5D.orderable=false&columns%5B12%5D.search.value=&columns%5B12%5D.search.regex=false&columns%5B13%5D.data=supplierId&columns%5B13%5D.name=&columns%5B13%5D.searchable=true&columns%5B13%5D.orderable=false&columns%5B13%5D.search.value=&columns%5B13%5D.search.regex=false&columns%5B14%5D.data=amount&columns%5B14%5D.name=&columns%5B14%5D.searchable=true&columns%5B14%5D.orderable=true&columns%5B14%5D.search.value=&columns%5B14%5D.search.regex=false&columns%5B15%5D.data=amountVat&columns%5B15%5D.name=&columns%5B15%5D.searchable=true&columns%5B15%5D.orderable=true&columns%5B15%5D.search.value=&columns%5B15%5D.search.regex=false&columns%5B16%5D.data=amountTotal&columns%5B16%5D.name=&columns%5B16%5D.searchable=true&columns%5B16%5D.orderable=true&columns%5B16%5D.search.value=&columns%5B16%5D.search.regex=false&columns%5B17%5D.data=rateVat&columns%5B17%5D.name=&columns%5B17%5D.searchable=true&columns%5B17%5D.orderable=true&columns%5B17%5D.search.value=&columns%5B17%5D.search.regex=false&columns%5B18%5D.data=subject&columns%5B18%5D.name=&columns%5B18%5D.searchable=true&columns%5B18%5D.orderable=true&columns%5B18%5D.search.value=&columns%5B18%5D.search.regex=false&columns%5B19%5D.data=verificationUserId&columns%5B19%5D.name=&columns%5B19%5D.searchable=true&columns%5B19%5D.orderable=false&columns%5B19%5D.search.value=&columns%5B19%5D.search.regex=false&columns%5B20%5D.data=verificationBranchId&columns%5B20%5D.name=&columns%5B20%5D.searchable=true&columns%5B20%5D.orderable=false&columns%5B20%5D.search.value=&columns%5B20%5D.search.regex=false&order%5B0%5D.column=4&order%5B0%5D.dir=desc&order%5B1%5D.column=5&order%5B1%5D.dir=asc&start={i}&length=10&search.value=&search.regex=false&batch=&imageName=&code=&no=&branchId=&supplierId=&verificationBranchId=&times={datetime_}+00%3A00+-+{datetime_}+23%3A59&status=&valid=&enabled=&_=1685000326609'
    data += requests.get(url=url_, headers=headers_).json()['data']
df = pd.json_normalize(data)


def get():
    save_path = f'D:\\000\\{datetime_}'
    if not os.path.exists(save_path):
        os.makedirs(save_path)
        os.makedirs(os.path.join(save_path, 'source'))
        os.makedirs(os.path.join(save_path, 'residue'))
        print('目录创建完毕')
        pass
    else:
        print('目录存在')
    invoices = df.path.tolist()
    if invoices:
        for invoice in invoices:
            file_path = invoice
            url = f"http://zphx-gpic-zj.baoxietech.com/static{file_path}"
            filename = url.split('/')[-1]
            response = requests.get(url)
            with open(os.path.join(os.path.join(save_path, 'source'), filename), 'wb') as f:
                f.write(response.content)
            with open(os.path.join(os.path.join(save_path, 'residue'), filename), 'wb') as f:
                f.write(response.content)
            print(f'{filename}下载完毕！！！')
    else:
        print('发票图片不存在')


start = time.time()
get()
end = time.time()
print(f'本次下载耗时：{end - start}秒')